var DSRT=(()=>{var _=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var z=(r,e)=>{for(var n in e)_(r,n,{get:e[n],enumerable:!0})},M=(r,e,n,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of A(e))!g.call(r,o)&&o!==n&&_(r,o,{get:()=>e[o],enumerable:!(t=b(e,o))||t.enumerable});return r};var k=r=>M(_({},"__esModule",{value:!0}),r);var R={};z(R,{App:()=>y,DSRT:()=>s,Engine:()=>m,Matrix4:()=>f,Vector3:()=>d,default:()=>v});async function w(r="/cdn/v1/"){try{let e=r+"dsrt.js";if((await fetch(e,{method:"HEAD"})).ok){await new Promise((o,a)=>{let l=document.createElement("script");l.src=e,l.onload=()=>o(),l.onerror=c=>a(c),document.head.appendChild(l)});let t=window.Module||typeof t<"u"&&t||null;if(t){let o=t.cwrap?t.cwrap.bind(t):null,a=t._malloc?t._malloc.bind(t):null,l=t._free?t._free.bind(t):null,c=t.HEAPF64;return{ready:!0,mode:"emscripten",exports:t,helpers:{cwrap:o,malloc:a,free:l,setArray:(i,h)=>{c.set(h,i/8)},getArray:(i,h)=>Array.from(c.subarray(i/8,i/8+h))}}}}}catch{}try{let e=await fetch(r+"dsrt.wasm");if(!e.ok)throw new Error("Failed fetching dsrt.wasm");let{instance:n}=await WebAssembly.instantiateStreaming(e,{});return{ready:!0,mode:"raw",exports:n.exports,helpers:{malloc:null,free:null,setArray:null,getArray:null}}}catch(e){return console.warn("WASM load failed:",e),{ready:!1,mode:"none",exports:null,helpers:{}}}}var s={version:"1.0.0",_wasmModule:null,_helpers:null,async init(r={}){let e=r.baseUrl||"/cdn/v1/",n=await w(e);return n.ready?(this._wasmModule=n.exports,this._helpers=n.helpers):(this._wasmModule=null,this._helpers=null),n}},d=class r{constructor(e=0,n=0,t=0){this.x=e,this.y=n,this.z=t}async length(){return s._wasmModule&&typeof s._wasmModule.dsrt_length3=="function"?s._wasmModule.dsrt_length3(this.x,this.y,this.z):Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}async dot(e){return s._wasmModule&&typeof s._wasmModule.dsrt_dot3=="function"?s._wasmModule.dsrt_dot3(this.x,this.y,this.z,e.x,e.y,e.z):this.x*e.x+this.y*e.y+this.z*e.z}async cross(e){if(s._wasmModule&&s._helpers&&s._helpers.malloc&&s._helpers.setArray){let a=s._helpers.malloc,l=s._helpers.free,c=s._helpers.setArray,i=s._helpers.getArray,h=a(24);if(s._helpers.cwrap){s._helpers.cwrap("dsrt_cross","void",["number","number","number","number","number","number","number"])(this.x,this.y,this.z,e.x,e.y,e.z,h);let u=i(h,3);return l(h),new r(u[0],u[1],u[2])}}let n=this.y*e.z-this.z*e.y,t=this.z*e.x-this.x*e.z,o=this.x*e.y-this.y*e.x;return new r(n,t,o)}async normalize(){if(s._wasmModule&&s._helpers&&s._helpers.malloc){let n=s._helpers.malloc,t=s._helpers.free,o=s._helpers.setArray,a=s._helpers.getArray,l=n(24);if(s._helpers.cwrap){s._helpers.cwrap("dsrt_normalize","void",["number","number","number","number"])(this.x,this.y,this.z,l);let i=a(l,3);return t(l),new r(i[0],i[1],i[2])}}let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return e===0?new r(0,0,0):new r(this.x/e,this.y/e,this.z/e)}clone(){return new r(this.x,this.y,this.z)}},f=class r{constructor(e=null){e&&e.length===16?this.elements=e.slice(0,16):this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}async multiply(e){if(s._wasmModule&&s._helpers&&s._helpers.malloc){let a=s._helpers.malloc,l=s._helpers.free,c=s._helpers.setArray,i=s._helpers.getArray;if(s._helpers.cwrap){let h=a(128),p=a(128),u=a(128);c(h,this.elements),c(p,e.elements),s._helpers.cwrap("dsrt_mat4_mul","void",["number","number","number"])(h,p,u);let x=i(u,16);return l(h),l(p),l(u),new r(x)}}let n=this.elements,t=e.elements,o=new Array(16).fill(0);for(let a=0;a<4;a++)for(let l=0;l<4;l++){let c=0;for(let i=0;i<4;i++)c+=n[a*4+i]*t[i*4+l];o[a*4+l]=c}return new r(o)}},m=class{constructor(e={}){this.config=e,this.running=!1,this._tick=this._tick.bind(this),this._subs=[]}start(){this.running||(this.running=!0,this._last=performance.now(),requestAnimationFrame(this._tick))}stop(){this.running=!1}_tick(e){if(!this.running)return;let n=(e-this._last)/1e3;this._last=e;for(let t of this._subs)t(n);requestAnimationFrame(this._tick)}onUpdate(e){this._subs.push(e)}},y=class{constructor(e={}){this.engine=new m(e.engine||{}),this.scene=[]}start(){this.engine.start()}stop(){this.engine.stop()}add(e){this.scene.push(e)}},P={DSRT:s,Vector3:d,Matrix4:f,Engine:m,App:y},v=P;return k(R);})();
